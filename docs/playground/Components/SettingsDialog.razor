@using Linqraft.Core

<div class="@(IsOpen ? "fixed inset-0 z-50 flex items-center justify-center" : "hidden")">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black opacity-50" @onclick="Close"></div>
    
    <!-- Dialog -->
    <div class="relative bg-gray-800 rounded-lg shadow-xl w-96 max-h-[80vh] overflow-y-auto">
        <div class="flex items-center justify-between px-4 py-3 border-b border-gray-700">
            <h3 class="text-lg font-medium text-gray-100">⚙️ Settings</h3>
            <button class="text-gray-400 hover:text-gray-200" @onclick="Close">✕</button>
        </div>
        
        <div class="p-4 space-y-4">
            <!-- Global Namespace -->
            <div class="space-y-1">
                <label class="text-sm text-gray-300">Global Namespace</label>
                <input type="text" 
                       class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-100 text-sm"
                       placeholder="(empty for global namespace)"
                       value="@Configuration.GlobalNamespace"
                       @onchange="@(e => Configuration = Configuration with { GlobalNamespace = e.Value?.ToString() ?? "" })" />
            </div>
            
            <!-- Record Generate -->
            <div class="flex items-center gap-2">
                <input type="checkbox" 
                       id="recordGenerate"
                       class="w-4 h-4"
                       checked="@Configuration.RecordGenerate"
                       @onchange="@(e => Configuration = Configuration with { RecordGenerate = (bool)(e.Value ?? false) })" />
                <label for="recordGenerate" class="text-sm text-gray-300">Generate Records (instead of classes)</label>
            </div>
            
            <!-- Property Accessor -->
            <div class="space-y-1">
                <label class="text-sm text-gray-300">Property Accessor</label>
                <select class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-100 text-sm"
                        value="@((int)Configuration.PropertyAccessor)"
                        @onchange="@(e => Configuration = Configuration with { PropertyAccessor = (PropertyAccessor)int.Parse(e.Value?.ToString() ?? "0") })">
                    <option value="@((int)PropertyAccessor.Default)">Default</option>
                    <option value="@((int)PropertyAccessor.GetAndSet)">get; set;</option>
                    <option value="@((int)PropertyAccessor.GetAndInit)">get; init;</option>
                    <option value="@((int)PropertyAccessor.GetAndInternalSet)">get; internal set;</option>
                </select>
            </div>
            
            <!-- Has Required -->
            <div class="flex items-center gap-2">
                <input type="checkbox" 
                       id="hasRequired"
                       class="w-4 h-4"
                       checked="@Configuration.HasRequired"
                       @onchange="@(e => Configuration = Configuration with { HasRequired = (bool)(e.Value ?? false) })" />
                <label for="hasRequired" class="text-sm text-gray-300">Use 'required' keyword</label>
            </div>
            
            <!-- Comment Output -->
            <div class="space-y-1">
                <label class="text-sm text-gray-300">Comment Output</label>
                <select class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-100 text-sm"
                        value="@((int)Configuration.CommentOutput)"
                        @onchange="@(e => Configuration = Configuration with { CommentOutput = (CommentOutputMode)int.Parse(e.Value?.ToString() ?? "0") })">
                    <option value="@((int)CommentOutputMode.None)">None</option>
                    <option value="@((int)CommentOutputMode.SummaryOnly)">Summary Only</option>
                    <option value="@((int)CommentOutputMode.All)">All</option>
                </select>
            </div>
            
            <!-- Array Nullability Removal -->
            <div class="flex items-center gap-2">
                <input type="checkbox" 
                       id="arrayNullabilityRemoval"
                       class="w-4 h-4"
                       checked="@Configuration.ArrayNullabilityRemoval"
                       @onchange="@(e => Configuration = Configuration with { ArrayNullabilityRemoval = (bool)(e.Value ?? false) })" />
                <label for="arrayNullabilityRemoval" class="text-sm text-gray-300">Array Nullability Removal</label>
            </div>
        </div>
        
        <div class="flex justify-end gap-2 px-4 py-3 border-t border-gray-700">
            <button class="px-4 py-2 text-sm text-gray-300 hover:text-gray-100" @onclick="Close">Cancel</button>
            <button class="px-4 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-500" @onclick="Apply">Apply</button>
        </div>
    </div>
</div>

@code {
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public EventCallback<bool> IsOpenChanged { get; set; }
    [Parameter] public LinqraftConfiguration Configuration { get; set; } = new() { CommentOutput = CommentOutputMode.None };
    [Parameter] public EventCallback<LinqraftConfiguration> ConfigurationChanged { get; set; }
    [Parameter] public EventCallback OnApply { get; set; }
    
    private async Task Close()
    {
        IsOpen = false;
        await IsOpenChanged.InvokeAsync(false);
    }
    
    private async Task Apply()
    {
        await ConfigurationChanged.InvokeAsync(Configuration);
        await OnApply.InvokeAsync();
        await Close();
    }
}
